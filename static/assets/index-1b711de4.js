var P=(x,n,s)=>new Promise((p,m)=>{var A=r=>{try{g(s.next(r))}catch(f){m(f)}},I=r=>{try{g(s.throw(r))}catch(f){m(f)}},g=r=>r.done?p(r.value):Promise.resolve(r.value).then(A,I);g((s=s.apply(x,n)).next())});import{x as _,X as K,a8 as v,Y as V,Z as k,_ as w,$ as i,a0 as L,a6 as h,a2 as a,A as y,a1 as t,a7 as U,a9 as $,an as O,h as c,ab as q}from"./index-1319d715.js";import{_ as j}from"./CommonPage-1b7131ea.js";import{_ as N}from"./QueryBarItem-8c7c36d3.js";import{u as E,_ as M,N as X}from"./useCRUD-32249973.js";import{a as C,_ as Y}from"./CrudTable-1b72018f.js";import{N as d}from"./Input-80da2416.js";import{N as Z,a as b}from"./FormItem-a3720c19.js";import"./AppPage-2c648aa5.js";const re=Object.assign({name:"API管理"},{__name:"index",setup(x){const n=_(null),s=_({}),p=K("permission"),{modalVisible:m,modalTitle:A,modalLoading:I,handleSave:g,modalForm:r,modalFormRef:f,handleEdit:S,handleDelete:z,handleAdd:R}=E({name:"API",initForm:{},doCreate:v.createApi,doUpdate:v.updateApi,doDelete:v.deleteApi,refresh:()=>{var o;return(o=n.value)==null?void 0:o.handleSearch()}}),T=_([]);V(()=>{var o;(o=n.value)==null||o.handleSearch(),v.getRoleList({page:1,page_size:9999}).then(e=>T.value=e.data)});function F(){return P(this,null,function*(){yield $dialog.confirm({title:"提示",type:"warning",content:"此操作会根据后端 app.routes 进行路由更新，确定继续刷新 API 操作？",confirm(){return P(this,null,function*(){var e;yield v.refreshApi(),$message.success("刷新完成"),(e=n.value)==null||e.handleSearch()})}})})}const B={path:[{required:!0,message:"请输入API路径",trigger:["input","blur","change"]}],method:[{required:!0,message:"请输入请求方式",trigger:["input","blur","change"]}],summary:[{required:!0,message:"请输入API简介",trigger:["input","blur","change"]}],tags:[{required:!0,message:"请输入Tags",trigger:["input","blur","change"]}]},D=[{title:"API路径",key:"path",width:"auto",align:"center",ellipsis:{tooltip:!0}},{title:"请求方式",key:"method",align:"center",width:"auto",ellipsis:{tooltip:!0}},{title:"API简介",key:"summary",width:"auto",align:"center",ellipsis:{tooltip:!0}},{title:"Tags",key:"tags",width:"auto",align:"center",ellipsis:{tooltip:!0}},{title:"操作",key:"actions",width:"auto",align:"center",fixed:"right",render(o){return[h(c(y,{size:"small",type:"primary",style:"margin-right: 8px;",onClick:()=>{S(o),r.value.roles=o.roles.map(e=>e=e.id)}},{default:()=>"编辑",icon:q("material-symbols:edit",{size:16})}),[[p,"post/api/v1/api/update"]]),c(X,{onPositiveClick:()=>z({api_id:o.id},!1),onNegativeClick:()=>{}},{trigger:()=>h(c(y,{size:"small",type:"error"},{default:()=>"删除",icon:q("material-symbols:delete-outline",{size:16})}),[[p,"delete/api/v1/api/delete"]]),default:()=>c("div",{},"确定删除该API吗?")})]}}];return(o,e)=>(k(),w(j,{"show-footer":"",title:"API列表"},{action:i(()=>[L("div",null,[h((k(),w(a(y),{class:"float-right mr-15",type:"primary",onClick:a(R)},{default:i(()=>[t(C,{icon:"material-symbols:add",size:18,class:"mr-5"}),U("新建API ")]),_:1},8,["onClick"])),[[a(p),"post/api/v1/api/create"]]),h((k(),w(a(y),{class:"float-right mr-15",type:"warning",onClick:F},{default:i(()=>[t(C,{icon:"material-symbols:refresh",size:18,class:"mr-5"}),U("刷新API ")]),_:1})),[[a(p),"post/api/v1/api/refresh"]])])]),default:i(()=>[t(Y,{ref_key:"$table",ref:n,"query-items":s.value,"onUpdate:queryItems":e[6]||(e[6]=l=>s.value=l),columns:D,"get-data":a(v).getApis},{queryBar:i(()=>[t(N,{label:"路径","label-width":40},{default:i(()=>[t(a(d),{value:s.value.path,"onUpdate:value":e[0]||(e[0]=l=>s.value.path=l),clearable:"",type:"text",placeholder:"请输入API路径",onKeypress:e[1]||(e[1]=$(l=>{var u;return(u=n.value)==null?void 0:u.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),t(N,{label:"API简介","label-width":70},{default:i(()=>[t(a(d),{value:s.value.summary,"onUpdate:value":e[2]||(e[2]=l=>s.value.summary=l),clearable:"",type:"text",placeholder:"请输入API简介",onKeypress:e[3]||(e[3]=$(l=>{var u;return(u=n.value)==null?void 0:u.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),t(N,{label:"Tags","label-width":40},{default:i(()=>[t(a(d),{value:s.value.tags,"onUpdate:value":e[4]||(e[4]=l=>s.value.tags=l),clearable:"",type:"text",placeholder:"请输入API模块",onKeypress:e[5]||(e[5]=$(l=>{var u;return(u=n.value)==null?void 0:u.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),t(M,{visible:a(m),"onUpdate:visible":e[11]||(e[11]=l=>O(m)?m.value=l:null),title:a(A),loading:a(I),onSave:a(g)},{default:i(()=>[t(a(Z),{ref_key:"modalFormRef",ref:f,"label-placement":"left","label-align":"left","label-width":80,model:a(r),rules:B},{default:i(()=>[t(a(b),{label:"API名称",path:"path"},{default:i(()=>[t(a(d),{value:a(r).path,"onUpdate:value":e[7]||(e[7]=l=>a(r).path=l),clearable:"",placeholder:"请输入API路径"},null,8,["value"])]),_:1}),t(a(b),{label:"请求方式",path:"method"},{default:i(()=>[t(a(d),{value:a(r).method,"onUpdate:value":e[8]||(e[8]=l=>a(r).method=l),clearable:"",placeholder:"请输入请求方式"},null,8,["value"])]),_:1}),t(a(b),{label:"API简介",path:"summary"},{default:i(()=>[t(a(d),{value:a(r).summary,"onUpdate:value":e[9]||(e[9]=l=>a(r).summary=l),clearable:"",placeholder:"请输入API简介"},null,8,["value"])]),_:1}),t(a(b),{label:"Tags",path:"tags"},{default:i(()=>[t(a(d),{value:a(r).tags,"onUpdate:value":e[10]||(e[10]=l=>a(r).tags=l),clearable:"",placeholder:"请输入Tags"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"])]),_:1}))}});export{re as default};
