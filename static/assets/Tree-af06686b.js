import{d as ae,h as x,n as on,o as he,B as $n,bp as Un,N as Mn,x as P,bh as Me,e as $,q as zn,y as _,Y as jn,bq as qn,aK as en,b6 as Hn,w as Vn,a as K,c as J,b as F,D as nn,k as fe,bj as be,F as ze,u as Gn,l as Yn,g as rn,as as Wn,aA as Xn,z as ke,J as p,K as Te,av as Ae,P as je,br as tn,bs as Qn,Q as M,L as Jn,j as Zn,bm as et,bt as ln,v as nt}from"./index-1319d715.js";import{d as tt,V as lt,c as at}from"./CrudTable-1b72018f.js";function dn(e){return typeof e=="string"?`s-${e}`:`n-${e}`}const it=ae({name:"Switcher",render(){return x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32"},x("path",{d:"M12 8l10 8l-10 8z"}))}}),cn=on("n-tree-select"),xe=on("n-tree"),ot=ae({name:"NTreeSwitcher",props:{clsPrefix:{type:String,required:!0},expanded:Boolean,selected:Boolean,hide:Boolean,loading:Boolean,onClick:Function},setup(e){const{renderSwitcherIconRef:l}=he(xe,null);return()=>{const{clsPrefix:c}=e;return x("span",{"data-switcher":!0,class:[`${c}-tree-node-switcher`,e.expanded&&`${c}-tree-node-switcher--expanded`,e.hide&&`${c}-tree-node-switcher--hide`],onClick:e.onClick},x("div",{class:`${c}-tree-node-switcher__icon`},x($n,null,{default:()=>{if(e.loading)return x(Un,{clsPrefix:c,key:"loading",radius:85,strokeWidth:20});const{value:u}=l;return u?u({expanded:e.expanded,selected:e.selected}):x(Mn,{clsPrefix:c,key:"switcher"},{default:()=>x(it,null)})}})))}}}),rt=ae({name:"NTreeNodeCheckbox",props:{clsPrefix:{type:String,required:!0},right:Boolean,focusable:Boolean,disabled:Boolean,checked:Boolean,indeterminate:Boolean,onCheck:Function},setup(e){const l=he(xe);function c(s){const{onCheck:d}=e;d&&d(s)}function u(s){e.indeterminate?c(!1):c(s)}return{handleUpdateValue:u,mergedTheme:l.mergedThemeRef}},render(){const{clsPrefix:e,mergedTheme:l,checked:c,indeterminate:u,disabled:s,focusable:d,handleUpdateValue:v}=this;return x("span",{class:[`${e}-tree-node-checkbox`,this.right&&`${e}-tree-node-checkbox--right`],"data-checkbox":!0},x(tt,{focusable:d,disabled:s,theme:l.peers.Checkbox,themeOverrides:l.peerOverrides.Checkbox,checked:c,indeterminate:u,onUpdateChecked:v}))}}),dt=ae({name:"TreeNodeContent",props:{clsPrefix:{type:String,required:!0},disabled:Boolean,checked:Boolean,selected:Boolean,onClick:Function,onDragstart:Function,tmNode:{type:Object,required:!0},nodeProps:Object},setup(e){const{renderLabelRef:l,renderPrefixRef:c,renderSuffixRef:u,labelFieldRef:s}=he(xe),d=P(null);function v(g){const{onClick:b}=e;b&&b(g)}function m(g){v(g)}return{selfRef:d,renderLabel:l,renderPrefix:c,renderSuffix:u,labelField:s,handleClick:m}},render(){const{clsPrefix:e,labelField:l,nodeProps:c,checked:u=!1,selected:s=!1,renderLabel:d,renderPrefix:v,renderSuffix:m,handleClick:g,onDragstart:b,tmNode:{rawNode:h,rawNode:{prefix:R,suffix:y,[l]:f}}}=this;return x("span",Object.assign({},c,{ref:"selfRef",class:[`${e}-tree-node-content`,c==null?void 0:c.class],onClick:g,draggable:b===void 0?void 0:!0,onDragstart:b}),v||R?x("div",{class:`${e}-tree-node-content__prefix`},v?v({option:h,selected:s,checked:u}):Me(R)):null,x("div",{class:`${e}-tree-node-content__text`},d?d({option:h,selected:s,checked:u}):Me(f)),m||y?x("div",{class:`${e}-tree-node-content__suffix`},m?m({option:h,selected:s,checked:u}):Me(y)):null)}});function an({position:e,offsetLevel:l,indent:c,el:u}){const s={position:"absolute",boxSizing:"border-box",right:0};if(e==="inside")s.left=0,s.top=0,s.bottom=0,s.borderRadius="inherit",s.boxShadow="inset 0 0 0 2px var(--n-drop-mark-color)";else{const d=e==="before"?"top":"bottom";s[d]=0,s.left=`${u.offsetLeft+6-l*c}px`,s.height="2px",s.backgroundColor="var(--n-drop-mark-color)",s.transformOrigin=d,s.borderRadius="1px",s.transform=e==="before"?"translateY(-4px)":"translateY(4px)"}return x("div",{style:s})}function ct({dropPosition:e,node:l}){return l.isLeaf===!1||l.children?!0:e!=="inside"}function st(e){return $(()=>e.leafOnly?"child":e.checkStrategy)}function Z(e,l){return!!e.rawNode[l]}function sn(e,l,c,u){e==null||e.forEach(s=>{c(s),sn(s[l],l,c,u),u(s)})}function ut(e,l,c,u,s){const d=new Set,v=new Set,m=[];return sn(e,u,g=>{if(m.push(g),s(l,g)){v.add(g[c]);for(let b=m.length-2;b>=0;--b)if(!d.has(m[b][c]))d.add(m[b][c]);else return}},()=>{m.pop()}),{expandedKeys:Array.from(d),highlightKeySet:v}}if(zn&&Image){const e=new Image;e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}function ft(e,l,c,u,s){const d=new Set,v=new Set,m=new Set,g=[],b=[],h=[];function R(f){f.forEach(k=>{if(h.push(k),l(c,k)){d.add(k[u]),m.add(k[u]);for(let S=h.length-2;S>=0;--S){const L=h[S][u];if(!v.has(L))v.add(L),d.has(L)&&d.delete(L);else break}}const N=k[s];N&&R(N),h.pop()})}R(e);function y(f,k){f.forEach(N=>{const S=N[u],L=d.has(S),A=v.has(S);if(!L&&!A)return;const j=N[s];if(j)if(L)k.push(N);else{g.push(S);const B=Object.assign(Object.assign({},N),{[s]:[]});k.push(B),y(j,B[s])}else k.push(N)})}return y(e,b),{filteredTree:b,highlightKeySet:m,expandedKeys:g}}const ht=ae({name:"TreeNode",props:{clsPrefix:{type:String,required:!0},tmNode:{type:Object,required:!0}},setup(e){const l=he(xe),{droppingNodeParentRef:c,droppingMouseNodeRef:u,draggingNodeRef:s,droppingPositionRef:d,droppingOffsetLevelRef:v,nodePropsRef:m,indentRef:g,blockLineRef:b,checkboxPlacementRef:h,checkOnClickRef:R,disabledFieldRef:y}=l,f=_(()=>!!e.tmNode.rawNode.checkboxDisabled),k=_(()=>Z(e.tmNode,y.value)),N=_(()=>l.disabledRef.value||k.value),S=$(()=>{const{value:i}=m;if(i)return i({option:e.tmNode.rawNode})}),L=P(null),A={value:null};jn(()=>{A.value=L.value.$el});function j(){const{tmNode:i}=e;if(!i.isLeaf&&!i.shallowLoaded){if(!l.loadingKeysRef.value.has(i.key))l.loadingKeysRef.value.add(i.key);else return;const{onLoadRef:{value:w}}=l;w&&w(i.rawNode).then(D=>{D!==!1&&l.handleSwitcherClick(i)}).finally(()=>{l.loadingKeysRef.value.delete(i.key)})}else l.handleSwitcherClick(i)}const B=_(()=>!k.value&&l.selectableRef.value&&(l.internalTreeSelect?l.mergedCheckStrategyRef.value!=="child"||l.multipleRef.value&&l.cascadeRef.value||e.tmNode.isLeaf:!0)),V=_(()=>l.checkableRef.value&&(l.cascadeRef.value||l.mergedCheckStrategyRef.value!=="child"||e.tmNode.isLeaf)),ee=_(()=>l.displayedCheckedKeysRef.value.includes(e.tmNode.key)),me=_(()=>{const{value:i}=V;if(!i)return!1;const{value:w}=R;return typeof w=="boolean"?w:w(e.tmNode.rawNode)});function ne(i){const{value:w}=l.expandOnClickRef,{value:D}=B,{value:re}=me;if(!D&&!w&&!re||en(i,"checkbox")||en(i,"switcher"))return;const{tmNode:Re}=e;D&&l.handleSelect(Re),w&&!Re.isLeaf&&j(),re&&oe(!ee.value)}function Ee(i){var w,D;b.value||(N.value||ne(i),(D=(w=S.value)===null||w===void 0?void 0:w.onClick)===null||D===void 0||D.call(w,i))}function ie(i){var w,D;b.value&&(N.value||ne(i),(D=(w=S.value)===null||w===void 0?void 0:w.onClick)===null||D===void 0||D.call(w,i))}function oe(i){l.handleCheck(e.tmNode,i)}function we(i){l.handleDragStart({event:i,node:e.tmNode})}function Fe(i){i.currentTarget===i.target&&l.handleDragEnter({event:i,node:e.tmNode})}function q(i){i.preventDefault(),l.handleDragOver({event:i,node:e.tmNode})}function Y(i){l.handleDragEnd({event:i,node:e.tmNode})}function W(i){i.currentTarget===i.target&&l.handleDragLeave({event:i,node:e.tmNode})}function Pe(i){i.preventDefault(),d.value!==null&&l.handleDrop({event:i,node:e.tmNode,dropPosition:d.value})}return{showDropMark:_(()=>{const{value:i}=s;if(!i)return;const{value:w}=d;if(!w)return;const{value:D}=u;if(!D)return;const{tmNode:re}=e;return re.key===D.key}),showDropMarkAsParent:_(()=>{const{value:i}=c;if(!i)return!1;const{tmNode:w}=e,{value:D}=d;return D==="before"||D==="after"?i.key===w.key:!1}),pending:_(()=>l.pendingNodeKeyRef.value===e.tmNode.key),loading:_(()=>l.loadingKeysRef.value.has(e.tmNode.key)),highlight:_(()=>{var i;return(i=l.highlightKeySetRef.value)===null||i===void 0?void 0:i.has(e.tmNode.key)}),checked:ee,indeterminate:_(()=>l.displayedIndeterminateKeysRef.value.includes(e.tmNode.key)),selected:_(()=>l.mergedSelectedKeysRef.value.includes(e.tmNode.key)),expanded:_(()=>l.mergedExpandedKeysRef.value.includes(e.tmNode.key)),disabled:N,checkable:V,mergedCheckOnClick:me,checkboxDisabled:f,selectable:B,expandOnClick:l.expandOnClickRef,internalScrollable:l.internalScrollableRef,draggable:l.draggableRef,blockLine:b,nodeProps:S,checkboxFocusable:l.internalCheckboxFocusableRef,droppingPosition:d,droppingOffsetLevel:v,indent:g,checkboxPlacement:h,contentInstRef:L,contentElRef:A,handleCheck:oe,handleDrop:Pe,handleDragStart:we,handleDragEnter:Fe,handleDragOver:q,handleDragEnd:Y,handleDragLeave:W,handleLineClick:ie,handleContentClick:Ee,handleSwitcherClick:j}},render(){const{tmNode:e,clsPrefix:l,checkable:c,expandOnClick:u,selectable:s,selected:d,checked:v,highlight:m,draggable:g,blockLine:b,indent:h,disabled:R,pending:y,internalScrollable:f,nodeProps:k,checkboxPlacement:N}=this,S=g&&!R?{onDragenter:this.handleDragEnter,onDragleave:this.handleDragLeave,onDragend:this.handleDragEnd,onDrop:this.handleDrop,onDragover:this.handleDragOver}:void 0,L=f?dn(e.key):void 0,A=N==="right",j=c?x(rt,{right:A,focusable:this.checkboxFocusable,disabled:R||this.checkboxDisabled,clsPrefix:l,checked:this.checked,indeterminate:this.indeterminate,onCheck:this.handleCheck}):null;return x("div",Object.assign({class:`${l}-tree-node-wrapper`},S),x("div",Object.assign({},b?k:void 0,{class:[`${l}-tree-node`,{[`${l}-tree-node--selected`]:d,[`${l}-tree-node--checkable`]:c,[`${l}-tree-node--highlight`]:m,[`${l}-tree-node--pending`]:y,[`${l}-tree-node--disabled`]:R,[`${l}-tree-node--selectable`]:s,[`${l}-tree-node--clickable`]:s||u||this.mergedCheckOnClick},k==null?void 0:k.class],"data-key":L,draggable:g&&b,onClick:this.handleLineClick,onDragstart:g&&b&&!R?this.handleDragStart:void 0}),qn(e.level,x("div",{class:`${l}-tree-node-indent`},x("div",{style:{width:`${h}px`}}))),x(ot,{clsPrefix:l,expanded:this.expanded,selected:d,loading:this.loading,hide:e.isLeaf,onClick:this.handleSwitcherClick}),A?null:j,x(dt,{ref:"contentInstRef",clsPrefix:l,checked:v,selected:d,onClick:this.handleContentClick,nodeProps:b?void 0:k,onDragstart:g&&!b&&!R?this.handleDragStart:void 0,tmNode:e}),g?this.showDropMark?an({el:this.contentElRef.value,position:this.droppingPosition,offsetLevel:this.droppingOffsetLevel,indent:h}):this.showDropMarkAsParent?an({el:this.contentElRef.value,position:"inside",offsetLevel:this.droppingOffsetLevel,indent:h}):null:null,A?j:null))}}),un=ht;function gt({props:e,fNodesRef:l,mergedExpandedKeysRef:c,mergedSelectedKeysRef:u,handleSelect:s,handleSwitcherClick:d}){const{value:v}=u,m=he(cn,null),g=m?m.pendingNodeKeyRef:P(v.length?v[v.length-1]:null);function b(h){if(!e.keyboard)return;const{value:R}=g;if(R===null){if((h.key==="ArrowDown"||h.key==="ArrowUp")&&h.preventDefault(),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(h.key)&&R===null){const{value:y}=l;let f=0;for(;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}else{const{value:y}=l;let f=y.findIndex(k=>k.key===R);if(!~f)return;if(h.key==="Enter")s(y[f]);else if(h.key==="ArrowDown")for(h.preventDefault(),f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}else if(h.key==="ArrowUp")for(h.preventDefault(),f-=1;f>=0;){if(!y[f].disabled){g.value=y[f].key;break}f-=1}else if(h.key==="ArrowLeft"){const k=y[f];if(k.isLeaf||!c.value.includes(R)){const N=k.getParent();N&&(g.value=N.key)}else d(k)}else if(h.key==="ArrowRight"){const k=y[f];if(k.isLeaf)return;if(!c.value.includes(R))d(k);else for(f+=1;f<y.length;){if(!y[f].disabled){g.value=y[f].key;break}f+=1}}}}return{pendingNodeKeyRef:g,handleKeydown:b}}const vt=ae({name:"TreeMotionWrapper",props:{clsPrefix:{type:String,required:!0},height:Number,nodes:{type:Array,required:!0},mode:{type:String,required:!0},onAfterEnter:{type:Function,required:!0}},render(){const{clsPrefix:e}=this;return x(Vn,{onAfterEnter:this.onAfterEnter,appear:!0,reverse:this.mode==="collapse"},{default:()=>x("div",{class:[`${e}-tree-motion-wrapper`,`${e}-tree-motion-wrapper--${this.mode}`],style:{height:Hn(this.height)}},this.nodes.map(l=>x(un,{clsPrefix:e,tmNode:l})))})}}),yt=K("tree",`
 font-size: var(--n-font-size);
 outline: none;
`,[J("ul, li",`
 margin: 0;
 padding: 0;
 list-style: none;
 `),J(">",[K("tree-node",[J("&:first-child",{marginTop:0})])]),K("tree-node-indent",`
 flex-grow: 0;
 flex-shrink: 0;
 height: 0;
 `),K("tree-motion-wrapper",[F("expand",[nn({duration:"0.2s"})]),F("collapse",[nn({duration:"0.2s",reverse:!0})])]),K("tree-node-wrapper",`
 box-sizing: border-box;
 padding: 3px 0;
 `),K("tree-node",`
 transform: translate3d(0,0,0);
 position: relative;
 display: flex;
 border-radius: var(--n-node-border-radius);
 transition: background-color .3s var(--n-bezier);
 `,[F("highlight",[K("tree-node-content",[fe("text",{borderBottomColor:"var(--n-node-text-color-disabled)"})])]),F("disabled",[K("tree-node-content",`
 color: var(--n-node-text-color-disabled);
 cursor: not-allowed;
 `)]),be("disabled",[F("clickable",[K("tree-node-content",`
 cursor: pointer;
 `)])])]),F("block-node",[K("tree-node-content",`
 flex: 1;
 min-width: 0;
 `)]),be("block-line",[K("tree-node",[be("disabled",[K("tree-node-content",[J("&:hover",{backgroundColor:"var(--n-node-color-hover)"})]),F("selectable",[K("tree-node-content",[J("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),F("pending",[K("tree-node-content",`
 background-color: var(--n-node-color-hover);
 `)]),F("selected",[K("tree-node-content",{backgroundColor:"var(--n-node-color-active)"})])])])]),F("block-line",[K("tree-node",[be("disabled",[J("&:hover",{backgroundColor:"var(--n-node-color-hover)"}),F("pending",`
 background-color: var(--n-node-color-hover);
 `),F("selectable",[be("selected",[J("&:active",{backgroundColor:"var(--n-node-color-pressed)"})])]),F("selected",{backgroundColor:"var(--n-node-color-active)"})]),F("disabled",`
 cursor: not-allowed;
 `)])]),K("tree-node-switcher",`
 cursor: pointer;
 display: inline-flex;
 flex-shrink: 0;
 height: 24px;
 width: 24px;
 align-items: center;
 justify-content: center;
 transition: transform .15s var(--n-bezier);
 vertical-align: bottom;
 `,[fe("icon",`
 position: relative;
 height: 14px;
 width: 14px;
 display: flex;
 color: var(--n-arrow-color);
 transition: color .3s var(--n-bezier);
 font-size: 14px;
 `,[K("icon",[ze()]),K("base-loading",`
 color: var(--n-loading-color);
 position: absolute;
 left: 0;
 top: 0;
 right: 0;
 bottom: 0;
 `,[ze()]),K("base-icon",[ze()])]),F("hide",{visibility:"hidden"}),F("expanded",{transform:"rotate(90deg)"})]),K("tree-node-checkbox",`
 display: inline-flex;
 height: 24px;
 width: 16px;
 vertical-align: bottom;
 align-items: center;
 justify-content: center;
 margin-right: 4px;
 `,[F("right","margin-left: 4px;")]),F("checkable",[K("tree-node-content",`
 padding: 0 6px;
 `)]),K("tree-node-content",`
 position: relative;
 display: inline-flex;
 align-items: center;
 min-height: 24px;
 box-sizing: border-box;
 line-height: 1.5;
 vertical-align: bottom;
 padding: 0 6px 0 4px;
 cursor: default;
 border-radius: var(--n-node-border-radius);
 text-decoration-color: #0000;
 text-decoration-line: underline;
 color: var(--n-node-text-color);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `,[J("&:last-child",{marginBottom:0}),fe("prefix",`
 display: inline-flex;
 margin-right: 8px;
 `),fe("text",`
 border-bottom: 1px solid #0000;
 transition: border-color .3s var(--n-bezier);
 flex-grow: 1;
 max-width: 100%;
 `),fe("suffix",`
 display: inline-flex;
 `)]),fe("empty","margin: auto;")]);var bt=globalThis&&globalThis.__awaiter||function(e,l,c,u){function s(d){return d instanceof c?d:new c(function(v){v(d)})}return new(c||(c=Promise))(function(d,v){function m(h){try{b(u.next(h))}catch(R){v(R)}}function g(h){try{b(u.throw(h))}catch(R){v(R)}}function b(h){h.done?d(h.value):s(h.value).then(m,g)}b((u=u.apply(e,l||[])).next())})};const Le=30;function kt(e,l,c,u){return{getIsGroup(){return!1},getKey(d){return d[e]},getChildren:u||(d=>d[l]),getDisabled(d){return!!(d[c]||d.checkboxDisabled)}}}const xt={allowCheckingNotLoaded:Boolean,filter:Function,defaultExpandAll:Boolean,expandedKeys:Array,keyField:{type:String,default:"key"},labelField:{type:String,default:"label"},childrenField:{type:String,default:"children"},disabledField:{type:String,default:"disabled"},defaultExpandedKeys:{type:Array,default:()=>[]},indeterminateKeys:Array,renderSwitcherIcon:Function,onUpdateIndeterminateKeys:[Function,Array],"onUpdate:indeterminateKeys":[Function,Array],onUpdateExpandedKeys:[Function,Array],"onUpdate:expandedKeys":[Function,Array]},mt=Object.assign(Object.assign(Object.assign(Object.assign({},rn.props),{accordion:Boolean,showIrrelevantNodes:{type:Boolean,default:!0},data:{type:Array,default:()=>[]},expandOnDragenter:{type:Boolean,default:!0},expandOnClick:Boolean,checkOnClick:{type:[Boolean,Function],default:!1},cancelable:{type:Boolean,default:!0},checkable:Boolean,draggable:Boolean,blockNode:Boolean,blockLine:Boolean,disabled:Boolean,checkedKeys:Array,defaultCheckedKeys:{type:Array,default:()=>[]},selectedKeys:Array,defaultSelectedKeys:{type:Array,default:()=>[]},multiple:Boolean,pattern:{type:String,default:""},onLoad:Function,cascade:Boolean,selectable:{type:Boolean,default:!0},indent:{type:Number,default:16},allowDrop:{type:Function,default:ct},animated:{type:Boolean,default:!0},checkboxPlacement:{type:String,default:"left"},virtualScroll:Boolean,watchProps:Array,renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,keyboard:{type:Boolean,default:!0},getChildren:Function,onDragenter:[Function,Array],onDragleave:[Function,Array],onDragend:[Function,Array],onDragstart:[Function,Array],onDragover:[Function,Array],onDrop:[Function,Array],onUpdateCheckedKeys:[Function,Array],"onUpdate:checkedKeys":[Function,Array],onUpdateSelectedKeys:[Function,Array],"onUpdate:selectedKeys":[Function,Array]}),xt),{internalTreeSelect:Boolean,internalScrollable:Boolean,internalScrollablePadding:String,internalRenderEmpty:Function,internalHighlightKeySet:Object,internalUnifySelectCheck:Boolean,internalCheckboxFocusable:{type:Boolean,default:!0},internalFocusable:{type:Boolean,default:!0},checkStrategy:{type:String,default:"all"},leafOnly:Boolean}),Nt=ae({name:"Tree",props:mt,setup(e){const{mergedClsPrefixRef:l,inlineThemeDisabled:c,mergedRtlRef:u}=Gn(e),s=Yn("Tree",u,l),d=rn("Tree","-tree",yt,Wn,e,l),v=P(null),m=P(null),g=P(null);function b(){var n;return(n=g.value)===null||n===void 0?void 0:n.listElRef}function h(){var n;return(n=g.value)===null||n===void 0?void 0:n.itemsElRef}const R=$(()=>{const{filter:n}=e;if(n)return n;const{labelField:t}=e;return(a,o)=>{if(!a.length)return!0;const r=o[t];return typeof r=="string"?r.toLowerCase().includes(a.toLowerCase()):!1}}),y=$(()=>{const{pattern:n}=e;return n?!n.length||!R.value?{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}:ft(e.data,R.value,n,e.keyField,e.childrenField):{filteredTree:e.data,highlightKeySet:null,expandedKeys:void 0}}),f=$(()=>Xn(e.showIrrelevantNodes?e.data:y.value.filteredTree,kt(e.keyField,e.childrenField,e.disabledField,e.getChildren))),k=he(cn,null),N=e.internalTreeSelect?k.dataTreeMate:f,{watchProps:S}=e,L=P([]);S!=null&&S.includes("defaultCheckedKeys")?ke(()=>{L.value=e.defaultCheckedKeys}):L.value=e.defaultCheckedKeys;const A=p(e,"checkedKeys"),j=Te(A,L),B=$(()=>N.value.getCheckedKeys(j.value,{cascade:e.cascade,allowNotLoaded:e.allowCheckingNotLoaded})),V=st(e),ee=$(()=>B.value.checkedKeys),me=$(()=>{const{indeterminateKeys:n}=e;return n!==void 0?n:B.value.indeterminateKeys}),ne=P([]);S!=null&&S.includes("defaultSelectedKeys")?ke(()=>{ne.value=e.defaultSelectedKeys}):ne.value=e.defaultSelectedKeys;const Ee=p(e,"selectedKeys"),ie=Te(Ee,ne),oe=P([]),we=n=>{oe.value=e.defaultExpandAll?N.value.getNonLeafKeys():n===void 0?e.defaultExpandedKeys:n};S!=null&&S.includes("defaultExpandedKeys")?ke(()=>{we(void 0)}):ke(()=>{we(e.defaultExpandedKeys)});const Fe=p(e,"expandedKeys"),q=Te(Fe,oe),Y=$(()=>f.value.getFlattenedNodes(q.value)),{pendingNodeKeyRef:W,handleKeydown:Pe}=gt({props:e,mergedSelectedKeysRef:ie,fNodesRef:Y,mergedExpandedKeysRef:q,handleSelect:_e,handleSwitcherClick:Ye});let i=null,w=null;const D=P(new Set),re=$(()=>e.internalHighlightKeySet||y.value.highlightKeySet),Re=Te(re,D),Ne=P(new Set),fn=$(()=>q.value.filter(n=>!Ne.value.has(n)));let qe=0;const ge=P(null),Se=P(null),Ce=P(null),pe=P(null),Ke=P(0),hn=$(()=>{const{value:n}=Se;return n?n.parent:null});Ae(p(e,"data"),()=>{Ne.value.clear(),W.value=null,ye()},{deep:!1});let Ie=!1;const Oe=()=>{Ie=!0,je(()=>{Ie=!1})};let ve;Ae(p(e,"pattern"),(n,t)=>{if(e.showIrrelevantNodes)if(ve=void 0,n){const{expandedKeys:a,highlightKeySet:o}=ut(e.data,e.pattern,e.keyField,e.childrenField,R.value);D.value=o,Oe(),ce(a,z(a),{node:null,action:"filter"})}else D.value=new Set;else if(!n.length)ve!==void 0&&(Oe(),ce(ve,z(ve),{node:null,action:"filter"}));else{t.length||(ve=q.value);const{expandedKeys:a}=y.value;a!==void 0&&(Oe(),ce(a,z(a),{node:null,action:"filter"}))}});function He(n){return bt(this,void 0,void 0,function*(){const{onLoad:t}=e;if(!t){yield Promise.resolve();return}const{value:a}=Ne;if(!a.has(n.key)){a.add(n.key);try{(yield t(n.rawNode))===!1&&se()}catch(o){console.error(o),se()}a.delete(n.key)}})}ke(()=>{var n;const{value:t}=f;if(!t)return;const{getNode:a}=t;(n=q.value)===null||n===void 0||n.forEach(o=>{const r=a(o);r&&!r.shallowLoaded&&He(r)})});const de=P(!1),X=P([]);Ae(fn,(n,t)=>{if(!e.animated||Ie){je(De);return}const a=new Set(t);let o=null,r=null;for(const T of n)if(!a.has(T)){if(o!==null)return;o=T}const I=new Set(n);for(const T of t)if(!I.has(T)){if(r!==null)return;r=T}if(o===null&&r===null)return;const{virtualScroll:E}=e,G=(E?g.value.listElRef:v.value).offsetHeight,le=Math.ceil(G/Le)+1;let H;if(o!==null&&(H=t),r!==null&&(H===void 0?H=n:H=H.filter(T=>T!==r)),de.value=!0,X.value=f.value.getFlattenedNodes(H),o!==null){const T=X.value.findIndex(O=>O.key===o);if(~T){const O=X.value[T].children;if(O){const Q=tn(O,n);X.value.splice(T+1,0,{__motion:!0,mode:"expand",height:E?Q.length*Le:void 0,nodes:E?Q.slice(0,le):Q})}}}if(r!==null){const T=X.value.findIndex(O=>O.key===r);if(~T){const O=X.value[T].children;if(!O)return;de.value=!0;const Q=tn(O,n);X.value.splice(T+1,0,{__motion:!0,mode:"collapse",height:E?Q.length*Le:void 0,nodes:E?Q.slice(0,le):Q})}}});const gn=$(()=>Qn(Y.value)),vn=$(()=>de.value?X.value:Y.value);function De(){const{value:n}=m;n&&n.sync()}function yn(){de.value=!1,e.virtualScroll&&je(De)}function z(n){const{getNode:t}=N.value;return n.map(a=>{var o;return((o=t(a))===null||o===void 0?void 0:o.rawNode)||null})}function ce(n,t,a){const{"onUpdate:expandedKeys":o,onUpdateExpandedKeys:r}=e;oe.value=n,o&&M(o,n,t,a),r&&M(r,n,t,a)}function Ve(n,t,a){const{"onUpdate:checkedKeys":o,onUpdateCheckedKeys:r}=e;L.value=n,r&&M(r,n,t,a),o&&M(o,n,t,a)}function bn(n,t){const{"onUpdate:indeterminateKeys":a,onUpdateIndeterminateKeys:o}=e;a&&M(a,n,t),o&&M(o,n,t)}function Be(n,t,a){const{"onUpdate:selectedKeys":o,onUpdateSelectedKeys:r}=e;ne.value=n,r&&M(r,n,t,a),o&&M(o,n,t,a)}function kn(n){const{onDragenter:t}=e;t&&M(t,n)}function xn(n){const{onDragleave:t}=e;t&&M(t,n)}function mn(n){const{onDragend:t}=e;t&&M(t,n)}function wn(n){const{onDragstart:t}=e;t&&M(t,n)}function Rn(n){const{onDragover:t}=e;t&&M(t,n)}function Nn(n){const{onDrop:t}=e;t&&M(t,n)}function ye(){Sn(),te()}function Sn(){ge.value=null}function te(){Ke.value=0,Se.value=null,Ce.value=null,pe.value=null,se()}function se(){i&&(window.clearTimeout(i),i=null),w=null}function Ge(n,t){if(e.disabled||Z(n,e.disabledField))return;if(e.internalUnifySelectCheck&&!e.multiple){_e(n);return}const a=t?"check":"uncheck",{checkedKeys:o,indeterminateKeys:r}=N.value[a](n.key,ee.value,{cascade:e.cascade,checkStrategy:V.value,allowNotLoaded:e.allowCheckingNotLoaded});Ve(o,z(o),{node:n.rawNode,action:a}),bn(r,z(r))}function Cn(n){if(e.disabled)return;const{key:t}=n,{value:a}=q,o=a.findIndex(r=>r===t);if(~o){const r=Array.from(a);r.splice(o,1),ce(r,z(r),{node:n.rawNode,action:"collapse"})}else{const r=f.value.getNode(t);if(!r||r.isLeaf)return;let I;if(e.accordion){const E=new Set(n.siblings.map(({key:G})=>G));I=a.filter(G=>!E.has(G)),I.push(t)}else I=a.concat(t);ce(I,z(I),{node:n.rawNode,action:"expand"})}}function Ye(n){e.disabled||de.value||Cn(n)}function _e(n){if(!(e.disabled||!e.selectable)){if(W.value=n.key,e.internalUnifySelectCheck){const{value:{checkedKeys:t,indeterminateKeys:a}}=B;e.multiple?Ge(n,!(t.includes(n.key)||a.includes(n.key))):Ve([n.key],z([n.key]),{node:n.rawNode,action:"check"})}if(e.multiple){const t=Array.from(ie.value),a=t.findIndex(o=>o===n.key);~a?e.cancelable&&t.splice(a,1):~a||t.push(n.key),Be(t,z(t),{node:n.rawNode,action:~a?"unselect":"select"})}else ie.value.includes(n.key)?e.cancelable&&Be([],[],{node:n.rawNode,action:"unselect"}):Be([n.key],z([n.key]),{node:n.rawNode,action:"select"})}}function pn(n){if(i&&(window.clearTimeout(i),i=null),n.isLeaf)return;w=n.key;const t=()=>{if(w!==n.key)return;const{value:a}=Ce;if(a&&a.key===n.key&&!q.value.includes(n.key)){const o=q.value.concat(n.key);ce(o,z(o),{node:n.rawNode,action:"expand"})}i=null,w=null};n.shallowLoaded?i=window.setTimeout(()=>{t()},1e3):i=window.setTimeout(()=>{He(n).then(()=>{t()})},1e3)}function Kn({event:n,node:t}){!e.draggable||e.disabled||Z(t,e.disabledField)||(We({event:n,node:t},!1),kn({event:n,node:t.rawNode}))}function Dn({event:n,node:t}){!e.draggable||e.disabled||Z(t,e.disabledField)||xn({event:n,node:t.rawNode})}function Tn(n){n.target===n.currentTarget&&te()}function An({event:n,node:t}){ye(),!(!e.draggable||e.disabled||Z(t,e.disabledField))&&mn({event:n,node:t.rawNode})}function Ln({event:n,node:t}){!e.draggable||e.disabled||Z(t,e.disabledField)||(qe=n.clientX,ge.value=t,wn({event:n,node:t.rawNode}))}function We({event:n,node:t},a=!0){var o;if(!e.draggable||e.disabled||Z(t,e.disabledField))return;const{value:r}=ge;if(!r)return;const{allowDrop:I,indent:E}=e;a&&Rn({event:n,node:t.rawNode});const G=n.currentTarget,{height:le,top:H}=G.getBoundingClientRect(),T=n.clientY-H;let O;I({node:t.rawNode,dropPosition:"inside",phase:"drag"})?T<=8?O="before":T>=le-8?O="after":O="inside":T<=le/2?O="before":O="after";const{value:_n}=gn;let C,U;const $e=_n(t.key);if($e===null){te();return}let Qe=!1;O==="inside"?(C=t,U="inside"):O==="before"?t.isFirstChild?(C=t,U="before"):(C=Y.value[$e-1],U="after"):(C=t,U="after"),!C.isLeaf&&q.value.includes(C.key)&&(Qe=!0,U==="after"&&(C=Y.value[$e+1],C?U="before":(C=t,U="inside")));const Je=C;if(Ce.value=Je,!Qe&&r.isLastChild&&r.key===C.key&&(U="after"),U==="after"){let Ze=qe-n.clientX,Ue=0;for(;Ze>=E/2&&C.parent!==null&&C.isLastChild&&Ue<1;)Ze-=E,Ue+=1,C=C.parent;Ke.value=Ue}else Ke.value=0;if((r.contains(C)||U==="inside"&&((o=r.parent)===null||o===void 0?void 0:o.key)===C.key)&&!(r.key===Je.key&&r.key===C.key)){te();return}if(!I({node:C.rawNode,dropPosition:U,phase:"drag"})){te();return}if(r.key===C.key)se();else if(w!==C.key)if(U==="inside"){if(e.expandOnDragenter){if(pn(C),!C.shallowLoaded&&w!==C.key){ye();return}}else if(!C.shallowLoaded){ye();return}}else se();else U!=="inside"&&se();pe.value=U,Se.value=C}function En({event:n,node:t,dropPosition:a}){if(!e.draggable||e.disabled||Z(t,e.disabledField))return;const{value:o}=ge,{value:r}=Se,{value:I}=pe;if(!(!o||!r||!I)&&e.allowDrop({node:r.rawNode,dropPosition:I,phase:"drag"})&&o.key!==r.key){if(I==="before"){const E=o.getNext({includeDisabled:!0});if(E&&E.key===r.key){te();return}}if(I==="after"){const E=o.getPrev({includeDisabled:!0});if(E&&E.key===r.key){te();return}}Nn({event:n,node:r.rawNode,dragNode:o.rawNode,dropPosition:a}),ye()}}function Fn(){De()}function Pn(){De()}function In(n){var t;if(e.virtualScroll||e.internalScrollable){const{value:a}=m;if(!((t=a==null?void 0:a.containerRef)===null||t===void 0)&&t.contains(n.relatedTarget))return;W.value=null}else{const{value:a}=v;if(a!=null&&a.contains(n.relatedTarget))return;W.value=null}}Ae(W,n=>{var t,a;if(n!==null){if(e.virtualScroll)(t=g.value)===null||t===void 0||t.scrollTo({key:n});else if(e.internalScrollable){const{value:o}=m;if(o===null)return;const r=(a=o.contentRef)===null||a===void 0?void 0:a.querySelector(`[data-key="${dn(n)}"]`);if(!r)return;o.scrollTo({el:r})}}}),Jn(xe,{loadingKeysRef:Ne,highlightKeySetRef:Re,displayedCheckedKeysRef:ee,displayedIndeterminateKeysRef:me,mergedSelectedKeysRef:ie,mergedExpandedKeysRef:q,mergedThemeRef:d,mergedCheckStrategyRef:V,nodePropsRef:p(e,"nodeProps"),disabledRef:p(e,"disabled"),checkableRef:p(e,"checkable"),selectableRef:p(e,"selectable"),expandOnClickRef:p(e,"expandOnClick"),onLoadRef:p(e,"onLoad"),draggableRef:p(e,"draggable"),blockLineRef:p(e,"blockLine"),indentRef:p(e,"indent"),cascadeRef:p(e,"cascade"),checkOnClickRef:p(e,"checkOnClick"),checkboxPlacementRef:e.checkboxPlacement,droppingMouseNodeRef:Ce,droppingNodeParentRef:hn,draggingNodeRef:ge,droppingPositionRef:pe,droppingOffsetLevelRef:Ke,fNodesRef:Y,pendingNodeKeyRef:W,disabledFieldRef:p(e,"disabledField"),internalScrollableRef:p(e,"internalScrollable"),internalCheckboxFocusableRef:p(e,"internalCheckboxFocusable"),internalTreeSelect:e.internalTreeSelect,renderLabelRef:p(e,"renderLabel"),renderPrefixRef:p(e,"renderPrefix"),renderSuffixRef:p(e,"renderSuffix"),renderSwitcherIconRef:p(e,"renderSwitcherIcon"),labelFieldRef:p(e,"labelField"),multipleRef:p(e,"multiple"),handleSwitcherClick:Ye,handleDragEnd:An,handleDragEnter:Kn,handleDragLeave:Dn,handleDragStart:Ln,handleDrop:En,handleDragOver:We,handleSelect:_e,handleCheck:Ge});function On(n){var t;(t=g.value)===null||t===void 0||t.scrollTo(n)}const Bn={handleKeydown:Pe,scrollTo:On,getCheckedData:()=>{if(!e.checkable)return{keys:[],options:[]};const{checkedKeys:n}=B.value;return{keys:n,options:z(n)}},getIndeterminateData:()=>{if(!e.checkable)return{keys:[],options:[]};const{indeterminateKeys:n}=B.value;return{keys:n,options:z(n)}}},Xe=$(()=>{const{common:{cubicBezierEaseInOut:n},self:{fontSize:t,nodeBorderRadius:a,nodeColorHover:o,nodeColorPressed:r,nodeColorActive:I,arrowColor:E,loadingColor:G,nodeTextColor:le,nodeTextColorDisabled:H,dropMarkColor:T}}=d.value;return{"--n-arrow-color":E,"--n-loading-color":G,"--n-bezier":n,"--n-font-size":t,"--n-node-border-radius":a,"--n-node-color-active":I,"--n-node-color-hover":o,"--n-node-color-pressed":r,"--n-node-text-color":le,"--n-node-text-color-disabled":H,"--n-drop-mark-color":T}}),ue=c?Zn("tree",void 0,Xe,e):void 0;return Object.assign(Object.assign({},Bn),{mergedClsPrefix:l,mergedTheme:d,rtlEnabled:s,fNodes:vn,aip:de,selfElRef:v,virtualListInstRef:g,scrollbarInstRef:m,handleFocusout:In,handleDragLeaveTree:Tn,handleScroll:Fn,getScrollContainer:b,getScrollContent:h,handleAfterEnter:yn,handleResize:Pn,cssVars:c?void 0:Xe,themeClass:ue==null?void 0:ue.themeClass,onRender:ue==null?void 0:ue.onRender})},render(){var e;const{fNodes:l,internalRenderEmpty:c}=this;if(!l.length&&c)return c();const{mergedClsPrefix:u,blockNode:s,blockLine:d,draggable:v,disabled:m,internalFocusable:g,checkable:b,handleKeydown:h,rtlEnabled:R,handleFocusout:y}=this,f=g&&!m,k=f?"0":void 0,N=[`${u}-tree`,R&&`${u}-tree--rtl`,b&&`${u}-tree--checkable`,(d||s)&&`${u}-tree--block-node`,d&&`${u}-tree--block-line`],S=A=>"__motion"in A?x(vt,{height:A.height,nodes:A.nodes,clsPrefix:u,mode:A.mode,onAfterEnter:this.handleAfterEnter}):x(un,{key:A.key,tmNode:A,clsPrefix:u});if(this.virtualScroll){const{mergedTheme:A,internalScrollablePadding:j}=this,B=et(j||"0");return x(ln,{ref:"scrollbarInstRef",onDragleave:v?this.handleDragLeaveTree:void 0,container:this.getScrollContainer,content:this.getScrollContent,class:N,theme:A.peers.Scrollbar,themeOverrides:A.peerOverrides.Scrollbar,tabindex:k,onKeydown:f?h:void 0,onFocusout:f?y:void 0},{default:()=>{var V;return(V=this.onRender)===null||V===void 0||V.call(this),x(lt,{ref:"virtualListInstRef",items:this.fNodes,itemSize:Le,ignoreItemResize:this.aip,paddingTop:B.top,paddingBottom:B.bottom,class:this.themeClass,style:[this.cssVars,{paddingLeft:B.left,paddingRight:B.right}],onScroll:this.handleScroll,onResize:this.handleResize,showScrollbar:!1,itemResizable:!0},{default:({item:ee})=>S(ee)})}})}const{internalScrollable:L}=this;return N.push(this.themeClass),(e=this.onRender)===null||e===void 0||e.call(this),L?x(ln,{class:N,tabindex:k,onKeydown:f?h:void 0,onFocusout:f?y:void 0,style:this.cssVars,contentStyle:{padding:this.internalScrollablePadding}},{default:()=>x("div",{onDragleave:v?this.handleDragLeaveTree:void 0,ref:"selfElRef"},this.fNodes.map(S))}):x("div",{class:N,tabindex:k,ref:"selfElRef",style:this.cssVars,onKeydown:f?h:void 0,onFocusout:f?y:void 0,onDragleave:v?this.handleDragLeaveTree:void 0},l.length?l.map(S):nt(this.$slots.empty,()=>[x(at,{class:`${u}-tree__empty`,theme:this.mergedTheme.peers.Empty,themeOverrides:this.mergedTheme.peerOverrides.Empty})]))}});export{Nt as N,xt as a,kt as c,cn as t,st as u};
